<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>EnsembleGPUArray · DiffEqGPU.jl</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-90474609-3"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-90474609-3', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://docs.sciml.ai/DiffEqGPU/stable/manual/ensemblegpuarray/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="DiffEqGPU.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DiffEqGPU.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">DiffEqGPU: Massively Data-Parallel GPU Solving of ODEs</a></li><li><a class="tocitem" href="../../getting_started/">Getting Started with GPU-Accelerated Differential Equations in Julia</a></li><li><span class="tocitem">Tutorials</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">GPU Ensembles</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/gpu_ensemble_basic/">Massively Data-Parallel ODE Solving the Lorenz Equation</a></li><li><a class="tocitem" href="../../tutorials/parallel_callbacks/">Massively Parallel ODE Solving with Event Handling and Callbacks</a></li><li><a class="tocitem" href="../../tutorials/multigpu/">Setting Up Multi-GPU Parallel Parameter Sweeps</a></li><li><a class="tocitem" href="../../tutorials/lower_level_api/">Using the EnsembleGPUKernel Lower Level API for Decreased Overhead</a></li><li><a class="tocitem" href="../../tutorials/weak_order_conv_sde/">Using the EnsembleGPUKernel SDE solvers for the expectation of SDEs </a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Within-Method GPU</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/within_method_gpu/">Within-Method GPU Parallelism of Ordinary Differential Equation Solves</a></li></ul></li></ul></li><li><span class="tocitem">Examples</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">GPU Ensembles</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/sde/">GPU Parallel Solving of Stochastic Differential Equations</a></li><li><a class="tocitem" href="../../examples/ad/">Using GPU-accelerated Ensembles with Automatic Differentiation</a></li><li><a class="tocitem" href="../../examples/reductions/">Batched Reductions for Lowering Peak Memory Requirements</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Within-Method GPU</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/reaction_diffusion/">GPU-Accelerated Stochastic Partial Differential Equations</a></li><li><a class="tocitem" href="../../examples/bruss/">GPU-Acceleration of a Stiff Nonlinear Partial Differential Equation</a></li></ul></li></ul></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../ensemblegpukernel/">EnsembleGPUKernel</a></li><li class="is-active"><a class="tocitem" href>EnsembleGPUArray</a><ul class="internal"><li><a class="tocitem" href="#API"><span>API</span></a></li></ul></li><li><a class="tocitem" href="../optimal_trajectories/">Choosing Optimal Numbers of Trajectories</a></li><li><a class="tocitem" href="../choosing_ensembler/">Choosing the Ensemble: EnsembleGPUArray vs EnsembleGPUKernel</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>EnsembleGPUArray</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>EnsembleGPUArray</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SciML/DiffEqGPU.jl/blob/master/docs/src/manual/ensemblegpuarray.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="EnsembleGPUArray"><a class="docs-heading-anchor" href="#EnsembleGPUArray">EnsembleGPUArray</a><a id="EnsembleGPUArray-1"></a><a class="docs-heading-anchor-permalink" href="#EnsembleGPUArray" title="Permalink"></a></h1><h2 id="API"><a class="docs-heading-anchor" href="#API">API</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="DiffEqGPU.EnsembleGPUArray" href="#DiffEqGPU.EnsembleGPUArray"><code>DiffEqGPU.EnsembleGPUArray</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">EnsembleGPUArray(cpu_offload = 0.2)</code></pre><p>An <code>EnsembleArrayAlgorithm</code> which utilizes the GPU kernels to parallelize each ODE solve with their separate ODE integrator on each kernel.</p><p><strong>Positional Arguments</strong></p><ul><li><code>cpu_offload</code>: the percentage of trajectories to offload to the CPU. Default is 0.2 or 20% of trajectories.</li></ul><p><strong>Limitations</strong></p><p><code>EnsembleGPUArray</code> requires being able to generate a kernel for <code>f</code> using KernelAbstractons.jl and solving the resulting ODE defined over <code>CuArray</code> input types. This introduces the following limitations on its usage:</p><ul><li><p>Not all standard Julia <code>f</code> functions are allowed. Only Julia <code>f</code> functions which are capable of being compiled into a GPU kernel are allowed. This notably means that certain features of Julia can cause issues inside of kernel, like:</p><ul><li>Allocating memory (building arrays)</li><li>Linear algebra (anything that calls BLAS)</li><li>Broadcast</li></ul></li><li><p>Not all ODE solvers are allowed, only those from OrdinaryDiffEq.jl. The tested feature set from OrdinaryDiffEq.jl includes:</p><ul><li>Explicit Runge-Kutta methods</li><li>Implicit Runge-Kutta methods</li><li>Rosenbrock methods</li><li>DiscreteCallbacks and ContinuousCallbacks</li></ul></li><li><p>Stiff ODEs require the analytical solution of every derivative function it requires. For example, Rosenbrock methods require the Jacobian and the gradient with respect to time, and so these two functions are required to be given. Note that they can be generated by the <a href="https://docs.juliadiffeq.org/latest/tutorials/advanced_ode_example/#Automatic-Derivation-of-Jacobian-Functions-1">modelingtoolkitize</a> approach.</p></li><li><p>To use multiple GPUs over clusters, one must manually set up one process per GPU. See the multi-GPU tutorial for more details.</p></li></ul><div class="admonition is-category-warn"><header class="admonition-header">Warn</header><div class="admonition-body"><p>Callbacks with <code>terminate!</code> does not work well with <code>EnsembleGPUArray</code> as the entire integration will hault when any of the trajectories hault. Use with caution.</p></div></div><p><strong>Example</strong></p><pre><code class="language-julia hljs">using DiffEqGPU, OrdinaryDiffEq
function lorenz(du, u, p, t)
    du[1] = p[1] * (u[2] - u[1])
    du[2] = u[1] * (p[2] - u[3]) - u[2]
    du[3] = u[1] * u[2] - p[3] * u[3]
end

u0 = Float32[1.0;0.0;0.0]
tspan = (0.0f0,100.0f0)
p = [10.0f0,28.0f0,8/3f0]
prob = ODEProblem(lorenz,u0,tspan,p)
prob_func = (prob,i,repeat) -&gt; remake(prob,p=rand(Float32,3).*p)
monteprob = EnsembleProblem(prob, prob_func = prob_func, safetycopy=false)
@time sol = solve(monteprob,Tsit5(),EnsembleGPUArray(CUDADevice()),trajectories=10_000,saveat=1.0f0)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/DiffEqGPU.jl/blob/96e905e83d0e63bd9f9164e4b65abd9eb9ee42b9/src/DiffEqGPU.jl#L275-L341">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="DiffEqGPU.EnsembleCPUArray" href="#DiffEqGPU.EnsembleCPUArray"><code>DiffEqGPU.EnsembleCPUArray</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">EnsembleCPUArray(cpu_offload = 0.2)</code></pre><p>An <code>EnsembleArrayAlgorithm</code> which utilizes the CPU kernels to parallelize each ODE solve with their separate ODE integrator on each kernel. This method is meant to be a debugging counterpart to <code>EnsembleGPUArray</code>, having the same behavior and using the same KernelAbstractions.jl process to build the combined ODE, but without the restrictions of <code>f</code> being a GPU-compatible kernel function.</p><p>It is unlikely that this method is useful beyond library development and debugging, as almost any case should be faster with <code>EnsembleThreads</code> or <code>EnsembleDistributed</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/DiffEqGPU.jl/blob/96e905e83d0e63bd9f9164e4b65abd9eb9ee42b9/src/DiffEqGPU.jl#L259-L272">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ensemblegpukernel/">« EnsembleGPUKernel</a><a class="docs-footer-nextpage" href="../optimal_trajectories/">Choosing Optimal Numbers of Trajectories »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Tuesday 14 February 2023 19:48">Tuesday 14 February 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
